openapi: "3.0.0"
info:
  title: "NII-DG REST API Specification"
  version: "1.0.0"
  description: "The REST API specification for performing data governance of research"
  license:
    name: "Apache 2.0"
    url: "https://raw.githubusercontent.com/NII-DG/nii-dg/main/Licence.txt"
paths:
  /validate:
    post:
      summary: Validate RO-Crate generated by the nii-dg library.
      description: |
        Validate RO-Crate generated by the nii-dg library or based on NII-DG schema.
        You need to send RO-Crate as a requestBody. If you want to perform validation partly,
        entity ID list MUST be send in query parameter.
      responses:
        "200":
          $ref: "#/components/responses/RequestId"
        "400":
          $ref: "#/components/responses/BadRequest"
        "500":
          $ref: "#/components/responses/InternalServerError"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ROCrate"
      parameters:
        - $ref: "#/components/parameters/entityIds"
  /{requestId}:
    get:
      summary: Get validation results.
      description: |
        Get status and result of validation process of specified ID. Property 'result' is returned only when the status is COMPLETE or FAILED.
      responses:
        "200":
          $ref: "#/components/responses/ResultResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "500":
          $ref: "#/components/responses/InternalServerError"
      parameters:
        - $ref: "#/components/parameters/requestId"
  /{requestId}/cancel:
    post:
      summary: Cancel validation process.
      description: |
         Submit a cancellation request of running validation process.
      responses:
        "200":
          $ref: "#/components/responses/RequestId"
        "400":
          $ref: "#/components/responses/BadRequest"
        "500":
          $ref: "#/components/responses/InternalServerError"
      parameters:
        - $ref: "#/components/parameters/requestId"
  /healthcheck:
    get:
      summary: Health check method for this endpoint.
      description: |
        Return status "OK" when this application server is existing healthy.
      responses:
        "200":
          $ref: "#/components/responses/HealthCheck"
        "500":
          $ref: "#/components/responses/InternalServerError"
components:
  schemas:
    RequestId:
      type: string
      format: uuid
      example: 7755fb3d-09f1-46e0-ac6e-d88e4d82cb05
    RequestIdResponse:
      type: object
      properties:
        requestId:
          $ref: "#/components/schemas/RequestId"
    ROCrate:
      type: object
      additionalProperties: true
      example: {"@context":"https://w3id.org/ro/crate/1.1/context",
        "@graph":[
          {
            "@id": "ro-crate-metadata.json",
            "@type": "CreativeWork",
            "conformsTo": {"@id": "https://w3id.org/ro/crate/1.1"},
            "about": {"@id": "./"}
          },
          {
            "@id": "./",
            "@type": "Dataset",
            "hasPart": [],
            "name": "example research project",
            "dateCreated": "2023-01-20T02:35:21.875+00:00",
            "@context": "https://raw.githubusercontent.com/ascade/nii_dg/develop/schema/context/base/RootDataEntity.json"
          }
        ]}
      description: RO-Crate object. The schema for RO-Crate is depended on nii-dg library.
    EntityId:
      type: string
      example:
        - "path/to/file"
        - "https://example.com/path/to/file"
    EntityIds:
      nullable: true
      type: array
      items:
        $ref: "#/components/schemas/EntityId"
    ValidationRequest:
      type: object
      properties:
        roCrate:
          $ref: "#/components/schemas/ROCrate"
        entityIds:
          $ref: "#/components/schemas/EntityIds"
    ValidationStatus:
      type: string
      enum:
        - UNKNOWN
        - QUEUED
        - RUNNING
        - COMPLETE
        - FAILED
        - CANCELING
        - CANCELED
    ValidationResult:
      type: object
      properties:
        entityId:
          $ref: "#/components/schemas/EntityId"
        prop:
          type: string
          example: "AmedFile:remoteLocation"
        reason:
          type: string
          example: Unable to fetch remote URL.
    ResultResponse:
      type: object
      properties:
        requestId:
          $ref: "#/components/schemas/RequestId"
        request:
          $ref: "#/components/schemas/ValidationRequest"
        status:
          $ref: "#/components/schemas/ValidationStatus"
        results:
          type: array
          items:
            $ref: "#/components/schemas/ValidationResult"
    BadRequest:
      type: object
      properties:
        message:
          type: string
          example: Inputted requestId is not found.
    NotFound:
      type: object
      properties:
        message:
          type: string
          example: Requested path is not found.
    InternalServerError:
      type: object
      properties:
        message:
          type: string
          example: An unexpected error occurred internally.
    HealthCheck:
      type: object
      properties:
        message:
          type: string
          example: OK.
  responses:
    RequestId:
      description: Accept the validation/cancellation request and return a request id of validation process.
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/RequestIdResponse"
    ResultResponse:
      description: Return validation results.
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ResultResponse"
    BadRequest:
      description: Bad Request.
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/BadRequest"
    NotFound:
      description: Not Found.
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/NotFound"
    InternalServerError:
      description: Internal Server Error.
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/InternalServerError"
    HealthCheck:
      description: Health check response for this endpoint.
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/HealthCheck"
  parameters:
    entityIds:
      name: entityIds
      in: query
      description: A set of entity ID specified for validation of some entities in the RO-Crate. When this parameter is not given, all entities in  the RO-Crate are validated.
      required: false
      schema:
        $ref: "#/components/schemas/EntityIds"
    requestId:
      name: requestId
      in: path
      description: Request ID of validation process.
      required: true
      schema:
        $ref: "#/components/schemas/RequestId"
