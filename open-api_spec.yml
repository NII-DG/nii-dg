openapi: "3.0.0"
info:
  title: "NII-DG REST API Specification"
  version: "1.0.0"
  description: "The REST API sepecification for performing data govenance of research"
  license:
    name: "Apache 2.0"
    url: "https://raw.githubusercontent.com/NII-DG/nii-dg/main/Licence.txt"
paths:
  /validate:
    post:
      summary: Validate RO-Crate generated by the nii-dg library.
      description: |
        TODO
      responses:
        "200":
          $ref: "#/components/responses/RequestId"
        "400":
          $ref: "#/components/responses/BadRequest"
        "500":
          $ref: "#/components/responses/InternalServerError"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ROCrate"
      parameters:
        - $ref: "#/components/parameters/entityIds"
  /{requestId}:
    get:
      summary: Get validation results.
      description: |
        TODO
      responses:
        "200":
          $ref: "#/components/responses/ResultResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "500":
          $ref: "#/components/responses/InternalServerError"
      parameters:
        - $ref: "#/components/parameters/requestId"
  /{requestId}/cancel:
    post:
      summary: Cancel validation process.
      description: |
        TODO
      responses:
        "200":
          $ref: "#/components/responses/RequestId"
        "400":
          $ref: "#/components/responses/BadRequest"
        "500":
          $ref: "#/components/responses/InternalServerError"
      parameters:
        - $ref: "#/components/parameters/requestId"
  /healthcheck:
    get:
      summary: Health check method for this endpoint.
      description: |
        TODO
      responses:
        "200":
          $ref: "#/components/responses/HealthCheck"
        "500":
          $ref: "#/components/responses/InternalServerError"
components:
  schemas:
    RequestId:
      type: string
      format: uuid
      example: 7755fb3d-09f1-46e0-ac6e-d88e4d82cb05
    RequestIdResponse:
      type: object
      properties:
        requestId:
          $ref: "#/components/schemas/RequestId"
    ROCrate:
      type: object
      additionalProperties: true
      description: RO-Crate object. The schema for RO-Crate is depended on nii-dg library.
    EntityId:
      type: string
      examples: 
        - "path/to/file"
        - "https://example.com/path/to/file"
    EntityIds:
      nullable: true
      type: array
      items:
        $ref: "#/components/schemas/EntityId"
    ValidationRequest:
      type: object
      properties:
        roCrate:
          $ref: "#/components/schemas/ROCrate"
        entityIds:
          $ref: "#/components/schemas/EntityIds"
    ValidationStatus:
      type: string
      enum:
        - UNKNOWN
        - QUEUED
        - RUNNING
        - COMPLETE
        - FAILED
        - CANCELING
        - CANCELED
    ValidationResult:
      type: object
      properties:
        entityId:
          $ref: "#/components/schemas/EntityId"
        prop:
          type: string
          example: "AmedFile:remoteLocation"
        reason:
          type: string
          example: Unable to fetch remote URL.
    ResultResponse:
      type: object
      properties:
        requestId:
          $ref: "#/components/schemas/RequestId"
        request:
          $ref: "#/components/schemas/ValidationRequest"
        status:
          $ref: "#/components/schemas/ValidationStatus"
        results:
          type: array
          items:
            $ref: "#/components/schemas/ValidationResult"
    BadRequest:
      type: object
      properties:
        message:
          type: string
          example: Inputted requestId is not found.
    NotFound:
      type: object
      properties:
        message:
          type: string
          example: Requested path is not found.
    InternalServerError:
      type: object
      properties:
        message:
          type: string
          example: An unexpected error occurred internally.
    HealthCheck:
      type: object
      properties:
        message:
          type: string
          example: OK.
  responses:
    RequestId:
      description: Accept the validation/cancellation request and return a request id for validation process.
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/RequestIdResponse"
    ResultResponse:
      description: Return validation results.
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ResultResponse"
    BadRequest:
      description: Bad Request.
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/BadRequest"
    NotFound:
      description: Not Found.
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/NotFound"
    InternalServerError:
      description: Internal Server Error.
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/InternalServerError"
    HealthCheck:
      description: Health check response for this endpoint.
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/HealthCheck"
  parameters:
    entityIds:
      name: entityIds
      in: query
      description: Entity ID set when validating on specfic entities. When this parameter is not set, whole RO-Crate is validated.
      required: false
      schema:
        $ref: "#/components/schemas/EntityIds"
    requestId:
      name: requestId
      in: path
      description: Request ID for validation process.
      required: true
      schema:
        $ref: "#/components/schemas/RequestId"
